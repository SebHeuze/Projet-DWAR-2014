$(document).ready(function(){function e(){$("#cadre_arrivee").css({top:$(this).position().top});$("#cadre_arrivee").css({left:$(this).position().left});$("#cadre_depart").css({top:$(this).position().top});$("#cadre_depart").css({left:$(this).position().left});$("#cadre_resultat").css({top:$(this).position().top});$("#cadre_resultat").css({left:$(this).position().left})}function n(){$("#all_favoris").hide(800);$.post("/adresse/find",{adresse:$("#adresse_depart").val()},function(e){if(e.length>1){$("#adresses_depart").append("<ul>");var t=new google.maps.LatLngBounds;u="A".charCodeAt(0);$.each(e,function(e,n){var r=new google.maps.LatLng(n.coord.latitude,n.coord.longitude);$("#adresses_depart").append("<li class='adresse_result' id=\""+n.id+"\"><img src='"+getPuceImageLetter(String.fromCharCode(u))+"'/> "+n.nom+" - "+n.cp+" "+n.ville+"</li>");a(r,n.nom);t.extend(r)});map.fitBounds(t);$("#adresses_depart").append("</ul>");$("#cadre").hide(800);$("#cadre_depart").show(800);$("#adresses_depart li").click(function(){$("#adresse_depart_id").attr("value",$(this).attr("id"));r();i()})}else{$("#adresse_depart_id").attr("value",e[0].id);i()}})}function r(){for(var e=0;e<t.length;e++){t[e].setMap(null)}t.length=0}function i(){$.post("/adresse/find",{adresse:$("#adresse_arrivee").val()},function(e){if(e.length>1){$("#adresses_arrivee").append("<ul>");var t=new google.maps.LatLngBounds;u="A".charCodeAt(0);$.each(e,function(e,n){var r=new google.maps.LatLng(n.coord.latitude,n.coord.longitude);$("#adresses_arrivee").append("<li class='adresse_result' id=\""+n.id+"\"><img src='"+getPuceImageLetter(String.fromCharCode(u))+"'/> "+n.nom+" - "+n.cp+" "+n.ville+"</li>");a(r,n.nom);t.extend(r)});map.fitBounds(t);$("#adresses_arrivee").append("</ul>");$("#cadre").hide(800);$("#cadre_depart").hide(800);$("#cadre_arrivee").show(800);$("#adresses_arrivee li").click(function(){$("#adresse_arrivee_id").attr("value",$(this).attr("id"));r();s()})}else{$("#adresse_arrivee_id").attr("value",e[0].id);s()}})}function s(){$.post("/adresse/itineraire",{idAdresseDepart:$("#adresse_depart_id").val(),idAdresseArrivee:$("#adresse_arrivee_id").val(),dateDepart:$("#date_depart").val(),dateRetour:$("#date_retour").val(),carburant:$("#carburant").val(),abonnementTan:$("input[name='abonnement_tan']:checked").val()},function(e){var t=0;var n=null;var r=null;e.trajetBus.listeWaypoints.forEach(function(e){if(n!=null&&r!=null){t=t+parseInt(o(n,r,e.latitude,e.longitude))}n=e.latitude;r=e.longitude});$("#cadre_resultat td:eq(0)").html(e.trajetBus.cout);$("#cadre_resultat td:eq(1)").html("Carb:"+e.trajetVoiture.cout.toFixed(2)+" Park:"+e.trajetVoiture.parking.cout.toFixed(2));$("#cadre_resultat td:eq(2)").html(t+"m / "+e.trajetBus.distanceRetour+"m");$("#cadre_resultat td:eq(3)").html(e.trajetVoiture.distanceAller+"m / "+e.trajetVoiture.distanceRetour+"m");$("#cadre_resultat td:eq(4)").html(e.trajetBus.tempsAller+"min / "+e.trajetBus.tempsRetour+"min");$("#cadre_resultat td:eq(5)").html(e.trajetVoiture.tempsAller+"min / "+e.trajetVoiture.tempsRetour+"min");$("#cadre").hide(800);$("#cadre_arrivee").hide(800);$("#cadre_depart").hide(800);$("#cadre_resultat").show(800);setDirectionsBus(e.trajetBus.listeWaypoints,e.adresseDepart,e.adresseArrivee);setDirectionsVoiture(e.trajetVoiture.listeWaypoints,e.adresseDepart,e.adresseArrivee,e.trajetVoiture.parking)})}function o(e,t,n,r){var i=6371e3;var s=(n-e).toRad();var o=(r-t).toRad();var u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.toRad())*Math.cos(n.toRad())*Math.sin(o/2)*Math.sin(o/2);var a=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));var f=i*a;return f.toFixed(2)}function a(e,n){var r=String.fromCharCode(u);var i=new google.maps.Marker({position:e,icon:getMarkerImage(r),title:n,map:map});u=u+1;t.push(i)}$("#date_depart").datetimepicker({dateFormat:"dd/mm/yy"});$("#date_retour").datetimepicker({dateFormat:"dd/mm/yy"});$("#adresse_depart").val("rue du gros chene");$("#adresse_arrivee").val("Mail Pablo Picasso");$("#date_depart").val("16/06/2014 16:00");$("#date_retour").val("16/06/2014 18:00");$("#all_favoris").draggable();$("#cadre").draggable({drag:e});$("#cadre_arrivee").draggable({drag:e});$("#cadre_depart").draggable({drag:e});$("#cadre_resultat").draggable({drag:e});$("li[id^=favoris_]").click(function(){var e=$(this).attr("id").replace(/favoris_/,"");$("#adresse_depart_id").val($("#favoris_depart_"+e).val());$("#adresse_arrivee_id").val($("#favoris_arrivee_"+e).val());$("#all_favoris").hide(800);s()});$("#favoris").click(function(){$.post("/adresse/favoris",{depart:$("#adresse_depart_id").val(),arrivee:$("#adresse_arrivee_id").val()},function(e){if(e==false){alert("Le favoris existe déjà")}else if(e==true){alert("Favoris ajouté avec succès")}else{alert("Une erreur est survenue")}})});$("#reload_page").click(function(){location.reload()});var t=[];$("#singlebutton").click(n);var u;Number.prototype.toRad=function(){return this*Math.PI/180}})